<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Hospital Management — Smart Triage</title>

  <!-- Font + Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

  <style>
    :root{
      --bg: #f7fbff;
      --panel: #ffffff;
      --apollo-blue: #005BAB;
      --apollo-accent: #00bfa6;
      --muted: #6b7a90;
      --glass: rgba(0,91,171,0.06);
      --card-shadow: 0 8px 30px rgba(2,22,84,0.06);
    }

    *{box-sizing:border-box;font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;}
    body{margin:0;background:linear-gradient(180deg,#fbfdff 0%,#f0f7ff 100%);color:#0d243b}

    /* Header */
    .header{display:flex;align-items:center;justify-content:space-between;padding:12px 20px;background:var(--panel);box-shadow:var(--card-shadow);flex-wrap:wrap;}
    .brand{display:flex;align-items:center;gap:12px;margin-bottom:8px;}
    .logo{width:48px;height:48px;border-radius:12px;background:linear-gradient(135deg,var(--apollo-blue),var(--apollo-accent));display:flex;align-items:center;justify-content:center;color:white;font-weight:700;font-size:18px}
    .brand h1{margin:0;font-size:16px}
    .nav{display:flex;gap:14px;align-items:center;flex-wrap:wrap}
    .nav a{color:var(--muted);text-decoration:none;font-weight:600;font-size:14px}
    .nav a.active{color:var(--apollo-blue)}

    .container{max-width:1200px;margin:20px auto;padding:0 15px}

    /* Layout grid */
    .grid{display:grid;grid-template-columns:1fr 350px;gap:18px}
    @media(max-width:1024px){.grid{grid-template-columns:1fr}}
    @media(max-width:480px){.grid{grid-template-columns:1fr}}

    .panel{background:var(--panel);border-radius:12px;padding:16px;box-shadow:var(--card-shadow)}
    .panel h2{margin:0 0 8px 0;color:var(--apollo-blue)}
    .muted{color:var(--muted);font-size:13px}

    /* Stats */
    .stats{display:flex;gap:8px;margin-bottom:12px;flex-wrap:wrap}
    .stat{flex:1 1 100px;background:linear-gradient(180deg,rgba(0,91,171,0.03),transparent);padding:10px;border-radius:8px;text-align:center}
    .stat .value{font-size:18px;font-weight:700;color:var(--apollo-blue)}
    .stat .label{font-size:12px;color:var(--muted)}

    /* Table */
    .table-wrap{overflow-x:auto;border-radius:10px;margin-top:12px}
    table{width:100%;border-collapse:collapse;font-size:14px}
    thead th{background:linear-gradient(90deg,var(--apollo-blue),var(--apollo-accent));color:white;padding:10px;text-align:left;font-weight:700;font-size:13px}
    tbody td{padding:10px;border-bottom:1px solid #eef4fb}
    tr.green{background:#e8fff8}
    tr.yellow{background:#fff7e6}
    tr.red{background:#fff0f0}
    tbody td button{font-size:12px;padding:6px 10px}

    /* Cards */
    .card{background:var(--panel);padding:14px;border-radius:12px;box-shadow:var(--card-shadow);margin-bottom:12px}
    .critical-card{border-left:4px solid #ff5959}
    .critical-card .title{color:#ff5959;font-weight:700;font-size:14px}

    .quick-form input{width:100%;padding:8px;margin-top:6px;border-radius:8px;border:1px solid #e6eef8;font-size:13px}

    /* Buttons */
    .btn{display:inline-block;padding:8px 12px;border-radius:8px;background:var(--apollo-blue);color:#fff;border:none;cursor:pointer;font-weight:700;font-size:13px;transition:all 0.2s ease;}
    .btn.ghost{background:transparent;color:var(--apollo-blue);border:2px solid var(--apollo-blue)}
    #addBtn:hover, #updateBtn:hover, #delBtn:hover, #refreshBtn:hover, tbody .btn.ghost:hover {filter: brightness(0.9);transform: translateY(-1px);}

    .top3{display:flex;flex-direction:column;gap:6px;font-size:13px}
    .alert-banner{background:rgba(255,80,80,0.08);padding:8px;border-radius:6px;margin-bottom:10px;border:1px solid rgba(255,80,80,0.08);font-size:13px}

    .footer{text-align:center;color:var(--muted);margin-top:20px;padding-bottom:20px;font-size:12px}

    .space-between{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap}
  </style>
</head>
<body>

  <header class="header">
    <div class="brand">
      <div class="logo">BG</div>
      <div>
        <h1>Hospital Management</h1>
        <div class="muted">AVL-backed emergency triage • C backend</div>
      </div>
    </div>
    <nav class="nav">
      <a href="#">Dashboard</a>
      <a href="#">Patients</a>
      <a href="#" class="active">Triage</a>
      <a href="#">Reports</a>
      <a href="#">Settings</a>
    </nav>
  </header>

  <main class="container">
    <div class="grid">

      <!-- LEFT -->
      <section>
        <div class="panel">
          <div class="space-between">
            <h2>Live Triage Dashboard</h2>
            <div class="muted">Real-time — sorted by severity</div>
          </div>

          <div id="alertArea"></div>

          <div class="stats">
            <div class="stat"><div class="label">Total Patients</div><div class="value" id="statTotal">0</div></div>
            <div class="stat"><div class="label">Critical (8-10)</div><div class="value" id="statCritical">0</div></div>
            <div class="stat"><div class="label">Average Severity</div><div class="value" id="statAvg">0</div></div>
          </div>

          <div class="table-wrap">
            <table id="triageTable">
              <thead>
                <tr><th>ID</th><th>Patient</th><th>Age</th><th>Severity</th><th>Action</th></tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- RIGHT -->
      <aside>
        <div class="card">
          <div class="space-between">
            <div>
              <div class="muted">Connected</div>
              <div style="font-weight:700;color:var(--apollo-blue);">AVL Backend • Local</div>
            </div>
            <button class="btn" id="refreshBtn"><i class="fas fa-sync-alt"></i> Refresh</button>
          </div>
        </div>

        <div class="card critical-card">
          <div class="title">Emergency Alert</div>
          <div class="muted">Highest severity patients appear here</div>
          <div id="criticalBox" style="margin-top:10px"></div>
        </div>

        <div class="card">
          <h4 style="margin:0 0 6px 0;color:var(--apollo-blue)">Quick Manage</h4>
          <div class="quick-form">
            <input id="inpId" type="number" placeholder="Patient ID" />
            <input id="inpName" type="text" placeholder="Name" />
            <input id="inpAge" type="number" placeholder="Age" />
            <input id="inpSeverity" type="number" placeholder="Severity (1-10)" />
            <div style="margin-top:8px;display:flex;gap:6px;flex-wrap:wrap;">
              <button class="btn" id="addBtn">Add</button>
              <button class="btn ghost" id="updateBtn">Update</button>
              <button class="btn" id="delBtn" style="background:#ff5959">Delete</button>
            </div>
          </div>
        </div>

        <div class="card">
          <h4 style="margin:0 0 6px 0;color:var(--apollo-blue)">Top 3 Critical</h4>
          <div id="top3" class="top3"></div>
        </div>
      </aside>
    </div>

    <div class="footer">© VizStruct 2025 – Data Structures Visualization Expo — Bharath — Guruprasad</div>
  </main>

  <script>
    const API = 'https://hospital-management-1-2e3d.onrender.com';
    let patients = [];

    async function fetchPatients() {
      try {
        const res = await fetch(API + '/patients');
        patients = await res.json();
      } catch (e) { patients = []; }
      patients.sort((a,b)=>b.severity - a.severity);
      render();
    }

    function render() {
      const tbody = document.querySelector('#triageTable tbody');
      tbody.innerHTML = '';

      patients.forEach(p => {
        const tr = document.createElement('tr');
        tr.className = p.severity >= 8 ? 'red' : p.severity >=5 ? 'yellow' : 'green';
        tr.innerHTML = `
          <td>${p.id}</td>
          <td><strong>${p.name}</strong><div class="muted" style="font-size:12px;">ID: ${p.id}</div></td>
          <td>${p.age}</td>
          <td><strong>${p.severity}</strong></td>
          <td><button class='btn ghost' onclick='prefill(${p.id})'>Edit</button></td>
        `;
        tbody.appendChild(tr);
      });

      document.getElementById('statTotal').textContent = patients.length;
      document.getElementById('statCritical').textContent = patients.filter(x=>x.severity>=8).length;
      document.getElementById('statAvg').textContent = (patients.reduce((s,p)=>s+p.severity,0)/Math.max(1,patients.length)).toFixed(2);

      const emergencies = patients.filter(x=>x.severity>=9);
      const alertArea = document.getElementById('alertArea');
      alertArea.innerHTML = emergencies.length ? `<div class='alert-banner'><i class='fas fa-bell' style='margin-right:6px;color:#d10000'></i>${emergencies.length} emergency(s) — Highest Severity: ${emergencies[0].severity}</div>` : '';

      const criticalBox = document.getElementById('criticalBox');
      criticalBox.innerHTML = patients[0] ? `<strong>${patients[0].name}</strong><div class='muted'>Severity: ${patients[0].severity}</div>` : '';

      const top3 = document.getElementById('top3');
      top3.innerHTML = '';
      patients.slice(0,3).forEach(p=>{
        const div=document.createElement('div');
        div.innerHTML = `<strong>${p.name}</strong> <span class='muted'>(Severity: ${p.severity})</span>`;
        top3.appendChild(div);
      });
    }

    function prefill(id){
      const p = patients.find(x=>x.id===id);
      if(!p) return;
      document.getElementById('inpId').value = p.id;
      document.getElementById('inpName').value = p.name;
      document.getElementById('inpAge').value = p.age;
      document.getElementById('inpSeverity').value = p.severity;
      window.scrollTo({top:0,behavior:'smooth'});
    }

    async function callApi(path,method='GET',body=null){
      try{
        const options={method, headers:{}};
        if(body){ options.headers['Content-Type']='application/json'; options.body=JSON.stringify(body); }
        const r=await fetch(API+path,options);
        return r.json();
      }catch{return null;}
    }

    document.getElementById('addBtn').addEventListener('click',async()=>{
      const id=Number(inpId.value), name=inpName.value, age=Number(inpAge.value), severity=Number(inpSeverity.value);
      if(!id||!name||!age||!severity) return alert('Fill all fields');
      await callApi('/addPatient','POST',{id,name,age,severity});
      fetchPatients();
    });

    document.getElementById('updateBtn').addEventListener('click',async()=>{
      const id=Number(inpId.value), severity=Number(inpSeverity.value);
      if(!id||!severity) return alert('Fill ID and Severity');
      await callApi('/updatePatient','PUT',{id,severity});
      fetchPatients();
    });

    document.getElementById('delBtn').addEventListener('click',async()=>{
      const id=Number(inpId.value);
      if(!id) return alert('Enter ID');
      await callApi('/deletePatient/'+id,'DELETE');
      fetchPatients();
    });

    document.getElementById('refreshBtn').addEventListener('click',fetchPatients);
    fetchPatients();
    setInterval(fetchPatients,5000);
  </script>
</body>
</html>

